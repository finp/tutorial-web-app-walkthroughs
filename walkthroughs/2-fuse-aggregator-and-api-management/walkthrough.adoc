// Attributes
:integreatly: Integreatly
:messaging-service: Red Hat AMQ Online
:messaging-service-version: 7.2
:integration-service: Fuse
:integration-service-version: 7.1
:code-ready-service: Code Ready
:launcher-service: Launcher
:api-mgmt-service: 3Scale
:AMQ-ProductLongName: Red Hat AMQ
:AMQ-BrokerVersion: 7.2
:Fuse-prodnamefull: Red Hat Fuse Online
:Fuse-version: 7.1
:3Scale-ProductName: Red Hat 3scale
:3Scale-ProductVersion: 2.3
:EnMasse-master-ProductLongName: EnMasse
:fuse-flights-aggregator-app-name: fuse-flights-aggregator-{user-sanitized-username}
:walkthrough: Integrating API-driven applications

= Managing and protecting APIs using API management

:context: integrating-api-driven-applications

This walkthrough demonstrates how an API can be protected and rate limited.

Organizations modernizing their applications typically create many APIs.
It then becomes paramount to understand the usage of these APIs and to ensure they are protected, for example, from a Denial-of-service attack.
It is possible to protect and limit access to APIs as part of an integration.

In this walkthrough, you use the *Fuse Aggregation App*, which is a demonstration app that provides data using an API.
The walkthrough shows how to deploy, edit, protect and rate-limit that API, using OpenShift, {launcher-service}, {code-ready-service} and {api-mgmt-service}.

image::images/arch.png[integration, role="integr8ly-img-responsive"]

[type=walkthroughResource,serviceName=openshift]
.Red Hat OpenShift
****
* link:{openshift-host}/console[Console, window="_blank"]
* link:https://help.openshift.com/[Openshift Online Help Center, window="_blank"]
* link:https://blog.openshift.com/[Openshift Blog, window="_blank"]
****

[type=walkthroughResource,serviceName=launcher]
.Launcher
****
* link:{launcher-url}[Console, window="_blank"]
* link:https://developers.redhat.com/products/openshiftio/overview/[Launcher Overview, window="_blank"]
* link:https://launcher.fabric8.io/docs/[Launcher Documentation, window="_blank"]
****

[type=walkthroughResource,serviceName=codeready]
.Code Ready
****
* link:{che-url}[Console, window="_blank"]
* link:https://developers.redhat.com/products/codeready-workspaces/overview/[Code Ready Overview, window="_blank"]
* link:https://access.redhat.com/documentation/en-us/red_hat_codeready_workspaces_for_openshift/1.0.0/[Code Ready Documentation, window="_blank"]
****

[type=walkthroughResource,serviceName=3scale]
.3Scale
****
* link:{api-management-url}[Console, window="_blank"]
* link:https://developers.redhat.com/products/3scale/overview/[3Scale Overview, window="_blank"]
* link:https://www.3scale.net[3Scale Website, window="_blank"]
****

:sectnums:

[time=5]
== Deploying the Fuse Aggregation App

The Fuse Aggregation App provides information about flights, you deploy it using Launcher.

// TODO placeholders for product names
// TODO append /launch/wizard/<project-name> to launcher url
// TODO flights endpoint url
. Log in to the link:{launcher-url}/launch/wizard/{walkthrough-namespace}[{launcher-service}, window="_blank"] wizard.

. Select the option to *Code Locally, Build and Deploy* in the *Select Target Environment* step.

. Select the *Authorize* button to allow Launcher create resources in the OpenShift cluster. This triggers an OAuth flow, and eventually redirects back to the {launcher-service} wizard.

. Select the blue down-arrow icon to continue the wizard.

. Select the *Aggregation* mission and *Fuse* runtime in the *Select Mission & Runtime* step

. Select the blue down-arrow icon to continue the wizard.

. Authorize your Github Account
.. Select the *Log In & Authorize Account* button in the *Authorize Git Provider* step.
.. This opens a Github OAuth page.
.. Select the *Authorize <organisation/user>* button at the bottom.
.. You will be redirected back to the {launcher-service} wizard.

. Select all blue down-arrow icons to continue the wizard, accepting the git repository name.

. Select the *Set Up Application* button to create a Git repository and provision the mission resources to OpenShift. A build for the *Fuse Aggregation App* is triggered and deployed.


[type=verification]
. Make sure following pods are running in the link:{openshift-host}/console/project/{walkthrough-namespace}[OpenShift Project, window="_blank"]:
+
* fuse-flights-aggregator
+
* arrivals
+
* departures
// TODO: flights api links to /camel/flights
. Navigate to the link:{route-fuse-flights-aggregator-host}/camel/flights[Flights Endpoint, window="_blank"] and check that the response includes details about 8 flights.

[type=verificationFail]
Verify that you followed each step in the procedure above.  If you are still having issues, contact your administrator.
